<!DOCTYPE html>
<html>
	<head>
		<title>学习一点通注册页面 </title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<!-- Custom Theme files -->
		<link rel="stylesheet" type="text/css" href="https://www.jq22.com/jquery/font-awesome.4.6.0.css">
		<link href="css/snow.css" rel="stylesheet" type="text/css" media="all" />
		<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />

	</head>
	<body>
		<div class="snow-container">
			<div class="snow foreground"></div>
			<div class="snow foreground layered"></div>
			<div class="snow middleground"></div>
			<div class="snow middleground layered"></div>
			<div class="snow background"></div>
			<div class="snow background layered"></div>
		</div>

		<div class="top-buttons-agileinfo">
			<a href="login.html">登录</a><a href="Javasrcipt:void(0)" class="active">注册</a>
		</div>
		<h1>学习一点通</h1>
		<div id="app">

			<div class="main-agileits">
				<!--form-stars-here-->
				<div class="form-w3-agile">
					<h2 class="sub-agileits-w3layouts">注册</h2>
					<form action="#" method="post">
						<div class="form clearfix">
							<input type="text" v-model="username" name="username"@focus="clearMsg" @blur ="checkInfo(0)" placeholder="姓名:(支持中英文名)" required="" />
							<input type="text" v-model="eamil" name="eamil"@focus="clearMsg" @blur ="checkInfo(1)" placeholder="邮箱" required="" />
							<input type="text" v-model="tel" name="tel"@focus="clearMsg" @blur ="checkInfo(2)" placeholder="手机号" required="" />
							<input type="text" v-model="cardid" name="cardid"@focus="clearMsg" @blur ="checkInfo(3)" placeholder="身份证" required="" />
							<input id="sex" type="text" placeholder="性别" list="sexlist" v-model="sex" @blur ="checkInfo(7)">
							<datalist id="sexlist">
								<option>男</option>
								<option>女</option>
							</datalist>
							<input type="password" v-model="pwd" name="pwd"@focus="clearMsg" @blur ="checkInfo(4)" placeholder="密码" required="" />
							<input type="password" v-model="pwd_1" name="pwd_1"@focus="clearMsg" @blur ="checkInfo(5)" placeholder="确认密码" required="" />
							<div class="yzm"><input v-model="cap" type="text" name="cap" @focus="clearMsg" @blur ="checkInfo(6)" placeholder="验证码" required="" /></div>
							<div class="post" id="post">
								<input id="btnSendCode" name="btnSendCode" type="button" value="获取验证码"  @click="sendMessage();" />
							</div>
						</div>
						<br>
						<div class="submit-w3l">
							<span style="color: red">{{info}}</span>
							<input type="button" value="注册" @click="login">
						</div>

					</form>
				</div>
			</div>

		</div>
		<!--//form-ends-here-->
		<!-- copyright -->
		<div class="copyright w3-agile">
			<p> © 2019 带下雪背景的登录注册页面 . All rights reserved | Design by <a href="#">Reserved</a></p>
		</div>
		<!-- //copyright -->
		<script src="js/jquery-2.1.4.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/time.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/vue.js"></script>
		<script type="text/javascript" src="js/axios.js"></script>
		<script type="text/javascript" src="js/qs.js"></script>
		
		<script type="text/javascript">
			var code = "";
			let vm = new Vue({
				el: "#app",
				data: {
					username: "", // 姓名
					eamil: "", // 邮箱
					tel: "", // 手机号码
					cardid: "", // 学号
					sex: "",
					pwd: "",
					pwd_1: "",
					cap: "",   // 验证码
					info: "",
					status: [false, false, false, false, false, false, false, false],
				},
				methods: {
					checkInfo(flag) { // 数据验证
						let correct = false;
						switch (flag) {
							case (0):
								var namereg = /^[\u4E00-\u9FA5A-Za-z\s]+(·[\u4E00-\u9FA5A-Za-z]+)*$/; // 匹配中英文姓名
								if (!(namereg.test(this.username))) {
									this.info = "姓名格式错误，请重新输入";
									this.username = "";
									correct = false;
									return;
								} else {
									correct = true;
									this.info = "";
								}
								break;
							case (1):
								var eamilreg = /^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;
								if (!(eamilreg.test(this.eamil))) {
									this.info = "邮箱格式错误";
									this.eamil = "";
									correct = false;
									return;
								} else {
									correct = true;
									this.info = "";
								}
								break;
							case (2):
								var telreg = /^1(3\d|4[5-9]|5[0-35-9]|6[567]|7[0-8]|8\d|9[0-35-9])\d{8}$/;
								if (!(telreg.test(this.tel))) {
									this.info = "手机号码格式错误";
									this.tel = "";
									correct = false;
									return;
								} else {
									correct = true;
									this.info = "";
								}
								break;
							case (3):
								var cardidreg = /^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
								if (!(cardidreg.test(this.cardid))) {
									this.info = "身份证格式错误,请检查后重新输入";
									this.cardid = "";
									correct = false;
									return;
								} else {
									correct = true;
									this.info = "";
								}
								break;
							case (4):
							var pwdreg = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
								if(!pwdreg.test(this.pwd)){
									this.pwd = "";
									this.info = "密码格式错误(至少8个字符，至包含1个大写字母，小写字母数字,不能包含特殊字符(非数字字母))"
									correct = false;
								}else {
									correct = true;
									this.info = "";
									
								}
								break;
							case (5):
								var pwdreg = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
								if(!pwdreg.test(this.pwd_1)){
									this.pwd_1 = "";
									this.info = "密码格式错误(至少8个字符，至包含1个大写字母，小写字母数字,不能包含特殊字符(非数字字母))"
									correct = false;
								}else{
									if(this.pwd != this.pwd_1){
										this.pwd_1 = "";
										this.info = "两次输入的密码不一致请重新输入";
										correct = false;
									}else{
										this.info = "";
										correct = true;
									}
								}
								break;
							case (7):
								if(!(this.sex == "男" || this.sex == "女")){
									this.sex = "";
									this.info = "性别请选择(男,女)";
									correct = false;
								}else{
									this.info = "";
									correct = true;
								}
								break;
						}
						Vue.set(this.status, flag, correct);
					},
					clearMsg(){ // 清除提示
						this.info = "";
					},
					// 邮箱发送验证码
				
					sendMessage(){
						if($.inArray(false, this.status) >= 0 && $.inArray(false, this.status) != 6){
							this.info = "信息不完整，请完整信息后在请求验证码";
							return;
						}
						sendMessage();
						axios.post("mem/code", qs.stringify({eamil: this.eamil})).then(result=>{
							if(result.data.code == 200){
								// 验证码发送成功
								confirm("验证码发送成功，请及时查收");
								code = result.data.data;
							}else{
								confirm("验证码发送失败");
							}
						})
					},
					login(){
						if(code ==  this.cap && code != ""){
							correct = true;
							Vue.set(this.status, 6, correct);
						}else{
							this.info = "验证码错误";
							correct = false;
							Vue.set(this.status, 6, correct);
							return;
						}
						if($.inArray(false, this.status) >= 0){
							this.info = "信息不完整，请完整信息后再登录";
							return;
						}
						axios.post("mem/login", qs.stringify({username: this.username, eamil: this.eamil, tel: this.tel, cardid: this.cardid, sex: this.sex, pwd: this.pwd})).then(result=>{
							if(result.data.code == 200){
								alert("注册成功");
								location.href="student/login_student.html";
							}else if(result.data.code == 500){
								alert("注册失败(存在违规数据)");
							}else if(result.data.code == 501){
								alert("注册失败");
							}
						})
					}
				}
			})
		</script>
	</body>
</html>
